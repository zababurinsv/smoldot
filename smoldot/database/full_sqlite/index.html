<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Filesystem-backed database containing all the information about a chain."><meta name="keywords" content="rust, rustlang, rust-lang, full_sqlite"><title>smoldot::database::full_sqlite - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled ><script id="default-settings"></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../../smoldot/index.html'><div class='logo-container rust-logo'><img src='../../../rust-logo.png' alt='logo'></div></a><p class="location">Module full_sqlite</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></div><p class="location"><a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">database</a></p><div id="sidebar-vars" data-name="full_sqlite" data-ty="mod" data-relpath="../"></div><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../../../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../../../settings.html"><img src="../../../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">database</a>::<wbr><a class="mod" href="">full_sqlite</a></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../../src/smoldot/database/full_sqlite.rs.html#18-1299" title="goto source code">[src]</a></span></h1><div class="docblock"><p>Filesystem-backed database containing all the information about a chain.</p>
<p>This module handles the persistent storage of the chain on disk.</p>
<h1 id="usage" class="section-header"><a href="#usage">Usage</a></h1>
<p>Use the <a href="../../../smoldot/database/full_sqlite/fn.open.html" title="open()"><code>open()</code></a> function to create a new database or open an existing one. <a href="../../../smoldot/database/full_sqlite/fn.open.html" title="open()"><code>open()</code></a>
returns a <a href="../../../smoldot/database/full_sqlite/enum.DatabaseOpen.html" title="DatabaseOpen"><code>DatabaseOpen</code></a> enum. This enum will contain either a <a href="../../../smoldot/database/full_sqlite/struct.SqliteFullDatabase.html" title="SqliteFullDatabase"><code>SqliteFullDatabase</code></a> object,
representing an access to the database, or a <a href="../../../smoldot/database/full_sqlite/struct.DatabaseEmpty.html" title="DatabaseEmpty"><code>DatabaseEmpty</code></a> if the database didn’t exist or
is empty. If that is the case, use <a href="../../../smoldot/database/full_sqlite/struct.DatabaseEmpty.html#method.initialize" title="DatabaseEmpty::initialize"><code>DatabaseEmpty::initialize</code></a> in order to populate it and
obtain a <a href="../../../smoldot/database/full_sqlite/struct.SqliteFullDatabase.html" title="SqliteFullDatabase"><code>SqliteFullDatabase</code></a>.</p>
<p>Use <a href="../../../smoldot/database/full_sqlite/struct.SqliteFullDatabase.html#method.insert" title="SqliteFullDatabase::insert"><code>SqliteFullDatabase::insert</code></a> to insert a new block in the database. The block is assumed
to have been successfully verified prior to insertion. An error is returned if this block is
already in the database or isn’t a descendant or ancestor of the latest finalized block.</p>
<p>Use <a href="../../../smoldot/database/full_sqlite/struct.SqliteFullDatabase.html#method.set_finalized" title="SqliteFullDatabase::set_finalized"><code>SqliteFullDatabase::set_finalized</code></a> to mark a block already in the database as finalized.
Any block that isn’t an ancestor or descendant will be removed. Reverting finalization is
not supported.</p>
<p>In order to minimize disk usage, it is not possible to efficiently retrieve the storage items
of blocks that are ancestors of the finalized block. When a block is finalized, the storage of
its ancestors is lost, and the only way to reconstruct it is to execute all blocks starting
from the genesis to the desired one.</p>
<h1 id="about-errors-handling" class="section-header"><a href="#about-errors-handling">About errors handling</a></h1>
<p>Most of the functions and methods in this module return a <code>Result</code> containing notably an
<a href="../../../smoldot/database/full_sqlite/enum.AccessError.html" title="AccessError"><code>AccessError</code></a>. This kind of errors can happen if the operating system returns an error when
accessing the file system, or if the database has been corrupted, for example by the user
manually modifying it.</p>
<p>There isn’t much that can be done to properly handle an <a href="../../../smoldot/database/full_sqlite/enum.AccessError.html" title="AccessError"><code>AccessError</code></a>. The only reasonable
solutions are either to stop the program, or to delete the entire database and recreate it.</p>
<h1 id="schema" class="section-header"><a href="#schema">Schema</a></h1>
<p>The SQL schema of the database, with explanatory comments, can be found in <code>open.rs</code>.</p>
</div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.Config.html" title="smoldot::database::full_sqlite::Config struct">Config</a></td><td class="docblock-short"><p>Configuration for the database.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.DatabaseEmpty.html" title="smoldot::database::full_sqlite::DatabaseEmpty struct">DatabaseEmpty</a></td><td class="docblock-short"><p>An open database. Holds file descriptors.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.InternalError.html" title="smoldot::database::full_sqlite::InternalError struct">InternalError</a></td><td class="docblock-short"><p>Low-level database error, such as an error while accessing the file system.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.SqliteFullDatabase.html" title="smoldot::database::full_sqlite::SqliteFullDatabase struct">SqliteFullDatabase</a></td><td class="docblock-short"><p>An open database. Holds file descriptors.</p>
</td></tr></table><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<table><tr class="module-item"><td><a class="enum" href="enum.AccessError.html" title="smoldot::database::full_sqlite::AccessError enum">AccessError</a></td><td class="docblock-short"><p>Error while accessing some information.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.ConfigTy.html" title="smoldot::database::full_sqlite::ConfigTy enum">ConfigTy</a></td><td class="docblock-short"><p>Type of database.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.CorruptedError.html" title="smoldot::database::full_sqlite::CorruptedError enum">CorruptedError</a></td><td class="docblock-short"><p>Error in the content of the database.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.DatabaseOpen.html" title="smoldot::database::full_sqlite::DatabaseOpen enum">DatabaseOpen</a></td><td class="docblock-short"><p>Either existing database or database prototype.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.FinalizedAccessError.html" title="smoldot::database::full_sqlite::FinalizedAccessError enum">FinalizedAccessError</a></td><td class="docblock-short"><p>Error while accessing the storage of the finalized block.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.InsertError.html" title="smoldot::database::full_sqlite::InsertError enum">InsertError</a></td><td class="docblock-short"><p>Error while calling <a href="../../../smoldot/database/full_sqlite/struct.SqliteFullDatabase.html#method.insert" title="SqliteFullDatabase::insert"><code>SqliteFullDatabase::insert</code></a>.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.SetFinalizedError.html" title="smoldot::database::full_sqlite::SetFinalizedError enum">SetFinalizedError</a></td><td class="docblock-short"><p>Error while calling <a href="../../../smoldot/database/full_sqlite/struct.SqliteFullDatabase.html#method.set_finalized" title="SqliteFullDatabase::set_finalized"><code>SqliteFullDatabase::set_finalized</code></a>.</p>
</td></tr></table><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<table><tr class="module-item"><td><a class="fn" href="fn.open.html" title="smoldot::database::full_sqlite::open fn">open</a></td><td class="docblock-short"><p>Opens the database using the given <a href="../../../smoldot/database/full_sqlite/struct.Config.html" title="Config"><code>Config</code></a>.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="smoldot" data-search-js="../../../search-index.js"></div>
    <script src="../../../main.js"></script></body></html>