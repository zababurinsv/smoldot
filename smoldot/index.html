<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Client for Polkadot and Substrate-compatible chains."><meta name="keywords" content="rust, rustlang, rust-lang, smoldot"><title>smoldot - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings"></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg">
<link rel="alternate icon" type="image/png" href="../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../smoldot/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><p class="location">Crate smoldot</p><div class="block version"><p>Version 0.1.0</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all smoldot's items</p></a><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#functions">Functions</a></li></ul></div><p class="location"></p><div id="sidebar-vars" data-name="smoldot" data-ty="mod" data-relpath="../"></div></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../settings.html"><img src="../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="">smoldot</a></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/smoldot/lib.rs.html#18-259" title="goto source code">[src]</a></span></h1><div class="docblock"><p>Client for Polkadot and Substrate-compatible chains.</p>
<h1 id="overview-of-a-blockchain" class="section-header"><a href="#overview-of-a-blockchain">Overview of a blockchain</a></h1>
<p>A blockchain is, in its essence, a distributed and decentralized key-value database. The
principle of a blockchain is to make it possible for any participant to perform modifications
to this database, and for all participants to eventually agree on the current state of said
database.</p>
<p>In Polkadot and Substrate-compatible chains, the state of this database is referred to as
“the storage”. The storage can be seen more or less as a very large <code>HashMap</code>.</p>
<p>A blockchain therefore consists in three main things:</p>
<ul>
<li>The initial state of the storage at the moment when the blockchain starts.</li>
<li>A list of blocks, where each block represents a group of modifications performed to the
storage.</li>
<li>A peer-to-peer network of clients connected to each other and exchanging information such
as newly-produced blocks.</li>
</ul>
<p>Blocks are built on top of each other, forming a sequential list of modifications to the
storage on top of its initial state.</p>
<h2 id="blocks" class="section-header"><a href="#blocks">Blocks</a></h2>
<p>A block primarily consists in three properties:</p>
<ul>
<li>A parent block, referred to by its hash.</li>
<li>An ordered list of <strong>extrinsics</strong>, representing a state change about the storage. An
extrinsic can be either a <strong>transaction</strong> or an <strong>intrisic</strong>.</li>
<li>A list of <strong>digest log items</strong>, which include information necessary to verify the
authenticity of the block, such as a cryptographic signature of the block made by its author.</li>
</ul>
<p>In order to make abstractions easier, there also exists what is called the <strong>genesis block</strong>,
or block number 0. It doesn’t have any parent, extrinsic, or digest item.</p>
<p>From these three block properties, the following other properties can be derived:</p>
<ul>
<li>The <strong>hash</strong> of the block. This is a unique 32 bytes identifier obtained by hashing all the
block’s information together in a specific way.</li>
<li>The <strong>block number</strong>. It is equal to the parent’s block number plus one, or equal to zero
for the genesis block</li>
<li>The state of the storage. It consists in the state of the storage of the parent block, on
top of which the block’s extrinsics have been applied. The state of the storage of the genesis
block is the initial state.</li>
</ul>
<blockquote>
<p><strong>Note</strong>: Not all these properties are held in memory or even on disk. For instance, the
state of the storage is quite large and holding a full version of the storage of
every single block in the chain would be unrealistic.</p>
</blockquote>
<h2 id="trie" class="section-header"><a href="#trie">Trie</a></h2>
<p>The <strong>trie</strong> is a data structure that plays an important role in the way a blockchain
functions.</p>
<p>It consists in a tree of nodes associated with a key, some of these nodes containing a value.
Each node is associated with a hash called the <strong>Merkle value</strong> that encompasses the Merkle
values of the node’s children. The Merkle value of the root node of the tree is designated
as “the Merkle trie root” or “the trie root”.</p>
<p>See the <a href="../smoldot/trie/index.html" title="trie"><code>trie</code></a> module for more details.</p>
<h2 id="block-headers" class="section-header"><a href="#block-headers">Block headers</a></h2>
<p>In practical terms, when a block needs to be stored or transferred between machines, it
is split in two parts: a <strong>header</strong> and a <strong>body</strong>. The body of a block simply consists in its
list of extrinsics.</p>
<blockquote>
<p><strong>Note</strong>: The body of a block and the list of extrinsics of a block are the exact same
thing, and these two designations can be used interchangeably.</p>
</blockquote>
<p>A block’s header contains the following:</p>
<ul>
<li>The hash of the parent of the block.</li>
<li>The block number.</li>
<li>The <strong>state trie root</strong>, which consists in the trie root of all the keys and values of the
storage of this block.</li>
<li>The <strong>extrinsics trie root</strong>, which consists in the Merkle root of a trie containing the
extrinsics of the block.</li>
<li>The list of digest log items.</li>
</ul>
<p>The hash of a block consists in the blake2 hash of its header.</p>
<p>See the <a href="../smoldot/header/index.html" title="header"><code>header</code></a> module for more information.</p>
<h2 id="runtime" class="section-header"><a href="#runtime">Runtime</a></h2>
<p>The state of the storage of each block is mostly opaque from the client’s perspective. There
exists, however, a few hardcoded keys, the most important one being
<code>[0x3a, 0x63, 0x6f, 0x64, 0x65]</code> (which is the ASCII encoding of the string <code>:code</code>). The
value associated with this key must always be a <a href="https://webassembly.org/">WebAssembly</a> binary
code called the <strong>runtime</strong>.</p>
<p>This WebAssembly binary code must obey a certain ABI and is responsible for the following
actions:</p>
<ul>
<li>Verifying whether a block has been correctly created by its author.</li>
<li>Providing the list of modifications to the storage performed by a block, given its header
and body.</li>
<li>Generating the header of newly-created blocks.</li>
<li>Validating transactions received from third-parties, in order to later be potentially
included in a block.</li>
<li>Providing the tools necessary to create transactions. See the <a href="../smoldot/metadata/index.html" title="metadata"><code>metadata</code></a> module.</li>
</ul>
<p>In other words, the runtime is responsible for all the actual <em>logic</em> behind the chain being
run. For instance, when performing a transfer of tokens between one account and another, it is
the runtime WebAssembly code that verifies that the balances are correct and updates them.</p>
<p>Since applying an extrinsic modifies the state of the storage, it is possible for an
extrinsic to modify this WebAssembly binary code. This is called a <strong>runtime upgrade</strong>. In
other words, any block can potentially modify the logic of the chain.</p>
<p>See also the <a href="../smoldot/executor/index.html" title="executor"><code>executor</code></a> module for more information.</p>
<h2 id="forks-and-finalization" class="section-header"><a href="#forks-and-finalization">Forks and finalization</a></h2>
<p>While blocks are built on top of each other, they don’t necessarily form one single chain. It
is possible for multiple different blocks to have the same parent, thereby forming multiple
chains. This is called a <strong>fork</strong>.</p>
<p>When multiple chains fly around in the network, each node select one chain they consider as
the “best”. However, because of latency, disconnects, or similar reasons, it is possible for
a node to not be immediately aware of the existence of a chain that it would consider as a
better chain than its current best. Later, when this node learns about this better chain, it
will need to perform a <strong>reorg</strong> (short for <em>reorganization</em>), where blocks that were part of
the best chain no longer are.</p>
<p>In order to avoid troublesome situations arising from reorgs, Substrate/Polkadot provides the
concept of <strong>finality</strong>. Once a block has been finalized, it is guaranteed to always be part
of the best chain. By extension, the parent of a finalized block is always finalized as well.
The genesis block of a chain is by definition is always finalized.</p>
<p>As such, a chain of blocks is composed of two parts: one <strong>finalized</strong> part (usually the
longest), and one non-finalized part. While the finalized part is a single linear list of
blocks, the non-finalized part consists in a <em>directed rooted tree</em>.</p>
<p>In order to finalize a block, Substrate/Polkadot nodes use the <strong>GrandPa</strong> algorithm. Nodes
that are authorized to do so by the runtime emit votes on the peer-to-peer network. When two
thirds or more of the authorized nodes have voted for a specific block to be finalized, it
effectively becomes finalized.</p>
<p>After these votes have been collected, they are collected in what is called a
<strong>justification</strong>. This justification can later be requested by nodes who might not have
received all the votes, or for example if they were offline.</p>
<p>See the <a href="../smoldot/chain/index.html" title="chain"><code>chain</code></a> and <a href="../smoldot/finality/index.html" title="finality"><code>finality</code></a> modules for more information.</p>
<h1 id="usage" class="section-header"><a href="#usage">Usage</a></h1>
<p>This library intentionally doesn’t provide any ready-to-use blockchain client. Instead, it
provides tools that can be combined together in order to create a client.</p>
<p>Components that are most certainly needed are:</p>
<ul>
<li>Connectivity to a peer-to-peer network. See the <a href="../smoldot/network/index.html" title="network"><code>network</code></a> module.</li>
<li>A persistent storage for the blocks. See the <a href="../smoldot/database/index.html" title="database"><code>database</code></a> module.</li>
<li>A state machine that holds information about the state of the chain and verifies the
authenticity and/or correctness of blocks received from the network. See the <a href="../smoldot/sync/index.html" title="sync"><code>sync</code></a>
module.</li>
</ul>
<p>Optionally:</p>
<ul>
<li>The capacity to author new blocks. This isn’t implemented as of the writing of this
documentation.</li>
<li>A JSON-RPC client, in order to put a convenient-to-use UI on top of the client. See the
<a href="../smoldot/json_rpc/index.html" title="json_rpc"><code>json_rpc</code></a> module.</li>
<li>TODO: telemetry</li>
</ul>
</div><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<table><tr class="module-item"><td><a class="mod" href="author/index.html" title="smoldot::author mod">author</a></td><td class="docblock-short"></td></tr><tr class="module-item"><td><a class="mod" href="chain/index.html" title="smoldot::chain mod">chain</a></td><td class="docblock-short"><p>Data structures describing a chain of blocks.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="chain_spec/index.html" title="smoldot::chain_spec mod">chain_spec</a></td><td class="docblock-short"><p>Substrate chain configuration.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="database/index.html" title="smoldot::database mod">database</a></td><td class="docblock-short"><p>Persistent data storage.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="executor/index.html" title="smoldot::executor mod">executor</a></td><td class="docblock-short"><p>WebAssembly runtime code execution.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="finality/index.html" title="smoldot::finality mod">finality</a></td><td class="docblock-short"><p>Finality consists is declaring a block as irreversible. It is now forever part of the chain.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="header/index.html" title="smoldot::header mod">header</a></td><td class="docblock-short"><p>Parsing SCALE-encoded header.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="informant/index.html" title="smoldot::informant mod">informant</a></td><td class="docblock-short"><p>Information string printed out.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="json_rpc/index.html" title="smoldot::json_rpc mod">json_rpc</a></td><td class="docblock-short"><p>JSON-RPC servers. Trusted access to the blockchain.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="libp2p/index.html" title="smoldot::libp2p mod">libp2p</a></td><td class="docblock-short"><p>Collection of libp2p connections.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="metadata/index.html" title="smoldot::metadata mod">metadata</a></td><td class="docblock-short"><p>Runtime-provided metadata</p>
</td></tr><tr class="module-item"><td><a class="mod" href="network/index.html" title="smoldot::network mod">network</a></td><td class="docblock-short"></td></tr><tr class="module-item"><td><a class="mod" href="sync/index.html" title="smoldot::sync mod">sync</a></td><td class="docblock-short"><p>Syncing, short for synchronizing, consists in synchronizing the state of a local chain with
the state of the chain contained in other machines, called <em>remotes</em> or <em>sources</em>.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="transactions/index.html" title="smoldot::transactions mod">transactions</a></td><td class="docblock-short"><p>Transactions handling.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="trie/index.html" title="smoldot::trie mod">trie</a></td><td class="docblock-short"><p>Radix-16 Merkle-Patricia trie.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="verify/index.html" title="smoldot::verify mod">verify</a></td><td class="docblock-short"><p>Methods that verify whether a block is correct.</p>
</td></tr></table><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<table><tr class="module-item"><td><a class="fn" href="fn.calculate_genesis_block_header.html" title="smoldot::calculate_genesis_block_header fn">calculate_genesis_block_header</a></td><td class="docblock-short"><p>Builds the header of the genesis block, from the values in storage.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="smoldot" data-search-js="../search-index.js"></div>
    <script src="../main.js"></script></body></html>