<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Radix-16 Merkle-Patricia trie."><meta name="keywords" content="rust, rustlang, rust-lang, trie"><title>smoldot::trie - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings"></script><script src="../../storage.js"></script><script src="../../crates.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../smoldot/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><p class="location">Module trie</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#functions">Functions</a></li></ul></div><p class="location"><a href="../index.html">smoldot</a></p><div id="sidebar-vars" data-name="trie" data-ty="mod" data-relpath="../"></div><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../index.html">smoldot</a>::<wbr><a class="mod" href="">trie</a></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/smoldot/trie.rs.html#18-218" title="goto source code">[src]</a></span></h1><div class="docblock"><p>Radix-16 Merkle-Patricia trie.</p>
<p>This Substrate/Polkadot-specific radix-16 Merkle-Patricia trie is a data structure that
associates keys with values, and that allows efficient verification of the integrity of the
data.</p>
<h1 id="overview" class="section-header"><a href="#overview">Overview</a></h1>
<p>The key-value storage that the blockchain maintains is represented by
<a href="https://en.wikipedia.org/wiki/Tree_data_structure">a tree</a>, where each key-value pair in the
storage corresponds to a node in that tree.</p>
<p>Each node in this tree has what is called a Merkle value associated to it. This Merkle value
consists, in its essence, in the combination of the storage value associated to that node and
the Merkle values of all of the node’s children. If the resulting Merkle value would be too
long, it is first hashed.</p>
<p>Since the Merkle values of a node’s children depend, in turn, of the Merkle value of their
own children, we can say that the Merkle value of a node depends on all of the node’s
descendants.</p>
<p>Consequently, the Merkle value of the root node of the tree depends on the storage values of
all the nodes in the tree.</p>
<p>See also <a href="https://en.wikipedia.org/wiki/Merkle_tree">the Wikipedia page for Merkle tree for a different
explanation</a>.</p>
<h2 id="efficient-updates" class="section-header"><a href="#efficient-updates">Efficient updates</a></h2>
<p>When a storage value gets modified, the Merkle value of the root node of the tree also gets
modified. Thanks to the tree layout, we don’t need to recalculate the Merkle value of the
entire tree, but only of the ancestors of the node which has been modified.</p>
<p>If the storage consists of N entries, recalculating the Merkle value of the trie root requires
on average only <code>log16(N)</code> operations.</p>
<h2 id="proof-of-storage-entry" class="section-header"><a href="#proof-of-storage-entry">Proof of storage entry</a></h2>
<p>In the situation where we want to know the storage value associated to a node, but we only
know the Merkle value of the root of the trie, it is possible to ask a third-party for the
unhashed Merkle values of the desired node and all its ancestors.</p>
<p>After having verified that the third-party has provided correct values, and that they match
the expected root node Merkle value known locally, we can extract the storage value from the
Merkle value of the desired node.</p>
<h1 id="details" class="section-header"><a href="#details">Details</a></h1>
<p>This data structure is a tree composed of nodes, each node being identified by a key. A key
consists in a sequence of 4-bits values called <em>nibbles</em>. Example key: <code>[3, 12, 7, 0]</code>.</p>
<p>Some of these nodes contain a value.</p>
<p>A node A is an <em>ancestor</em> of another node B if the key of A is a prefix of the key of B. For
example, the node whose key is <code>[3, 12]</code> is an ancestor of the node whose key is
<code>[3, 12, 8, 9]</code>. B is a <em>descendant</em> of A.</p>
<p>Nodes exist only either if they contain a value, or if their key is the longest shared prefix
of two or more nodes that contain a value. For example, if nodes <code>[7, 2, 9, 11]</code> and
<code>[7, 2, 14, 8]</code> contain a value, then node <code>[7, 2]</code> also exist, because it is the longest
prefix shared between the two.</p>
<p>The <em>Merkle value</em> of a node is composed, amongst other things, of its associated value and of
the Merkle value of its descendants. As such, modifying a node modifies the Merkle value of
all its ancestors. Note, however, that modifying a node modifies the Merkle value of <em>only</em>
its ancestors. As such, the time spent calculating the Merkle value of the root node of a trie
mostly depends on the number of modifications that are performed on it, and only a bit on the
size of the trie.</p>
</div><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<table><tr class="module-item"><td><a class="mod" href="calculate_root/index.html" title="smoldot::trie::calculate_root mod">calculate_root</a></td><td class="docblock-short"><p>Freestanding function that calculates the root of a radix-16 Merkle-Patricia trie.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="node_value/index.html" title="smoldot::trie::node_value mod">node_value</a></td><td class="docblock-short"><p>Calculation of the Merkle value of a node given the information about it.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="prefix_proof/index.html" title="smoldot::trie::prefix_proof mod">prefix_proof</a></td><td class="docblock-short"><p>Scanning, through trie proofs, the list of all keys that share a certain prefix.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="proof_verify/index.html" title="smoldot::trie::proof_verify mod">proof_verify</a></td><td class="docblock-short"><p>Verification of a trie proof.</p>
</td></tr><tr class="module-item"><td><a class="mod" href="trie_structure/index.html" title="smoldot::trie::trie_structure mod">trie_structure</a></td><td class="docblock-short"><p>Manages the structure of a trie. Allows inserting and removing nodes, but does not store any
value. Only the structure is stored.</p>
</td></tr></table><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.BytesToNibbles.html" title="smoldot::trie::BytesToNibbles struct">BytesToNibbles</a></td><td class="docblock-short"><p>Turns an iterator of bytes into an iterator of nibbles corresponding to these bytes.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.Nibble.html" title="smoldot::trie::Nibble struct">Nibble</a></td><td class="docblock-short"><p>A single nibble with four bits.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.Trie.html" title="smoldot::trie::Trie struct">Trie</a></td><td class="docblock-short"><p>Radix-16 Merkle-Patricia trie.</p>
</td></tr></table><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<table><tr class="module-item"><td><a class="enum" href="enum.NibbleFromU8Error.html" title="smoldot::trie::NibbleFromU8Error enum">NibbleFromU8Error</a></td><td class="docblock-short"><p>Error when building a <a href="../../smoldot/trie/struct.Nibble.html" title="Nibble"><code>Nibble</code></a> from a <code>u8</code>.</p>
</td></tr></table><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2>
<table><tr class="module-item"><td><a class="fn" href="fn.all_nibbles.html" title="smoldot::trie::all_nibbles fn">all_nibbles</a></td><td class="docblock-short"><p>Returns an iterator of all possible nibble values.</p>
</td></tr><tr class="module-item"><td><a class="fn" href="fn.bytes_to_nibbles.html" title="smoldot::trie::bytes_to_nibbles fn">bytes_to_nibbles</a></td><td class="docblock-short"><p>Turns an iterator of bytes into an iterator of nibbles corresponding to these bytes.</p>
</td></tr><tr class="module-item"><td><a class="fn" href="fn.empty_trie_merkle_value.html" title="smoldot::trie::empty_trie_merkle_value fn">empty_trie_merkle_value</a></td><td class="docblock-short"><p>Returns the Merkle value of the root of an empty trie.</p>
</td></tr><tr class="module-item"><td><a class="fn" href="fn.nibbles_to_bytes_extend.html" title="smoldot::trie::nibbles_to_bytes_extend fn">nibbles_to_bytes_extend</a></td><td class="docblock-short"><p>Turns an iterator of nibbles into an iterator of bytes.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><div id="rustdoc-vars" data-root-path="../../" data-current-crate="smoldot" data-search-js="../../search-index.js"></div>
    <script src="../../main.js"></script></body></html>