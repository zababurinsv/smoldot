<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Finalized block header, plus tree of authenticated non-finalized block headers."><meta name="keywords" content="rust, rustlang, rust-lang, blocks_tree"><title>smoldot::chain::blocks_tree - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled ><script id="default-settings"></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../../smoldot/index.html'><div class='logo-container rust-logo'><img src='../../../rust-logo.png' alt='logo'></div></a><p class="location">Module blocks_tree</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></div><p class="location"><a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">chain</a></p><div id="sidebar-vars" data-name="blocks_tree" data-ty="mod" data-relpath="../"></div><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../../../brush.svg" width="18" height="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" class="help-button">?</button>
                <a id="settings-menu" href="../../../settings.html"><img src="../../../wheel.svg" width="18" height="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">smoldot</a>::<wbr><a href="../index.html">chain</a>::<wbr><a class="mod" href="">blocks_tree</a></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../../src/smoldot/chain/blocks_tree.rs.html#18-432" title="goto source code">[src]</a></span></h1><div class="docblock"><p>Finalized block header, plus tree of authenticated non-finalized block headers.</p>
<p>This module provides the <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html" title="NonFinalizedTree"><code>NonFinalizedTree</code></a> type. This type is a data structure
containing a valid tree of block headers, plus the state necessary to verify new blocks with
the intent to add them to that tree. Each block header additionally holds a user-chosen
opaque data.</p>
<p>The state in the <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html" title="NonFinalizedTree"><code>NonFinalizedTree</code></a> consists of:</p>
<ul>
<li>One “latest finalized” block and various information about its ancestors, akin to a
<a href="../../../smoldot/chain/chain_information/struct.ChainInformation.html" title="chain_information::ChainInformation"><code>chain_information::ChainInformation</code></a>.</li>
<li>Zero or more blocks that descend from that latest finalized block.</li>
</ul>
<p>The latest finalized block is a block that is guaranted to never be reverted. While it can
always be set to the genesis block of the chain, it is preferable, in order to reduce
memory utilization, to maintain it to a block that is as high as possible in the chain.</p>
<blockquote>
<p><strong>Note</strong>: While mechanisms such as GrandPa provide a network-wide way to designate a block
as final, the concept of GrandPa-provided finality doesn’t necessarily have to
match the concept of finality in the <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html" title="NonFinalizedTree"><code>NonFinalizedTree</code></a>. For example, an API
user might decide to optimistically assume that the block whose number is
<code>highest_block - 5</code> is automatically finalized, and fall back to rebuilding a new
<a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html" title="NonFinalizedTree"><code>NonFinalizedTree</code></a> if that assumption turns out to not be true. The finalized
block in the <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html" title="NonFinalizedTree"><code>NonFinalizedTree</code></a> only represents a block that the
<a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html" title="NonFinalizedTree"><code>NonFinalizedTree</code></a> itself cannot remove, not a block that cannot be removed in
the absolute.</p>
</blockquote>
<p>A block can be added to the chain by calling <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html#method.verify_header" title="NonFinalizedTree::verify_header"><code>NonFinalizedTree::verify_header</code></a> or
<a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html#method.verify_body" title="NonFinalizedTree::verify_body"><code>NonFinalizedTree::verify_body</code></a>. As explained in details in
<a href="../../../smoldot/verify/index.html">the <code>verify</code> module</a>, verifying the header only verifies the authenticity of
a block and not its correctness. Verifying both the header and body provides the strongest
guarantee, but requires knowledge of the storage of the block that is parent of the block to
verify.</p>
<blockquote>
<p><strong>Note</strong>: There typically exists two kinds of clients: full and light. Full clients store
the state of the storage, while light clients don’t. For this reason, light
clients can only verify the header of new blocks. Both full and light clients
should wait for a block to be finalized if they want to be certain that it will
forever remain part of the chain.</p>
</blockquote>
<p>Additionally, a <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html#method.verify_justification" title="NonFinalizedTree::verify_justification"><code>NonFinalizedTree::verify_justification</code></a> method is provided in order to
verify the correctness of a <a href="../../../smoldot/finality/justification/index.html">justification</a>.</p>
</div><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2>
<table><tr class="module-item"><td><a class="struct" href="struct.BlockAccess.html" title="smoldot::chain::blocks_tree::BlockAccess struct">BlockAccess</a></td><td class="docblock-short"><p>Access to a block’s information and hierarchy.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.BodyInsert.html" title="smoldot::chain::blocks_tree::BodyInsert struct">BodyInsert</a></td><td class="docblock-short"><p>Holds the <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html" title="NonFinalizedTree"><code>NonFinalizedTree</code></a> and allows insert a successfully-verified block into it.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.BodyVerifyRuntimeRequired.html" title="smoldot::chain::blocks_tree::BodyVerifyRuntimeRequired struct">BodyVerifyRuntimeRequired</a></td><td class="docblock-short"><p>Verification is pending. In order to continue, a <a href="../../../smoldot/executor/host/struct.HostVmPrototype.html" title="host::HostVmPrototype"><code>host::HostVmPrototype</code></a> of the runtime
of the parent block must be provided.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.Config.html" title="smoldot::chain::blocks_tree::Config struct">Config</a></td><td class="docblock-short"><p>Configuration for the <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html" title="NonFinalizedTree"><code>NonFinalizedTree</code></a>.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.FinalityApply.html" title="smoldot::chain::blocks_tree::FinalityApply struct">FinalityApply</a></td><td class="docblock-short"><p>Returned by <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html#method.verify_justification" title="NonFinalizedTree::verify_justification"><code>NonFinalizedTree::verify_justification</code></a> and
<a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html#method.verify_grandpa_commit_message" title="NonFinalizedTree::verify_grandpa_commit_message"><code>NonFinalizedTree::verify_grandpa_commit_message</code></a> on success.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.HeaderInsert.html" title="smoldot::chain::blocks_tree::HeaderInsert struct">HeaderInsert</a></td><td class="docblock-short"><p>Mutably borrows the <a href="../../../smoldot/chain/blocks_tree/struct.NonFinalizedTree.html" title="NonFinalizedTree"><code>NonFinalizedTree</code></a> and allows insert a successfully-verified block
into it.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.NonFinalizedTree.html" title="smoldot::chain::blocks_tree::NonFinalizedTree struct">NonFinalizedTree</a></td><td class="docblock-short"><p>Holds state about the current state of the chain for the purpose of verifying headers.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.RuntimeCompilation.html" title="smoldot::chain::blocks_tree::RuntimeCompilation struct">RuntimeCompilation</a></td><td class="docblock-short"><p>A new runtime must be compiled.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.SetFinalizedBlockIter.html" title="smoldot::chain::blocks_tree::SetFinalizedBlockIter struct">SetFinalizedBlockIter</a></td><td class="docblock-short"><p>Iterator producing the newly-finalized blocks removed from the state when the finalized block
is updated.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.StorageGet.html" title="smoldot::chain::blocks_tree::StorageGet struct">StorageGet</a></td><td class="docblock-short"><p>Loading a storage value is required in order to continue.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.StorageNextKey.html" title="smoldot::chain::blocks_tree::StorageNextKey struct">StorageNextKey</a></td><td class="docblock-short"><p>Fetching the key that follows a given one is required in order to continue.</p>
</td></tr><tr class="module-item"><td><a class="struct" href="struct.StoragePrefixKeys.html" title="smoldot::chain::blocks_tree::StoragePrefixKeys struct">StoragePrefixKeys</a></td><td class="docblock-short"><p>Fetching the list of keys with a given prefix is required in order to continue.</p>
</td></tr></table><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2>
<table><tr class="module-item"><td><a class="enum" href="enum.BodyVerifyError.html" title="smoldot::chain::blocks_tree::BodyVerifyError enum">BodyVerifyError</a></td><td class="docblock-short"><p>Error while verifying a block body.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.BodyVerifyStep1.html" title="smoldot::chain::blocks_tree::BodyVerifyStep1 enum">BodyVerifyStep1</a></td><td class="docblock-short"><p>Block verification, either just finished or still in progress.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.BodyVerifyStep2.html" title="smoldot::chain::blocks_tree::BodyVerifyStep2 enum">BodyVerifyStep2</a></td><td class="docblock-short"><p>Block verification, either just finished or still in progress.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.CommitVerifyError.html" title="smoldot::chain::blocks_tree::CommitVerifyError enum">CommitVerifyError</a></td><td class="docblock-short"><p>Error that can happen when verifying a Grandpa commit.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.FinalityVerifyError.html" title="smoldot::chain::blocks_tree::FinalityVerifyError enum">FinalityVerifyError</a></td><td class="docblock-short"><p>Error that can happen when verifying a proof of finality.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.HeaderVerifyError.html" title="smoldot::chain::blocks_tree::HeaderVerifyError enum">HeaderVerifyError</a></td><td class="docblock-short"><p>Error that can happen when verifying a block header.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.HeaderVerifySuccess.html" title="smoldot::chain::blocks_tree::HeaderVerifySuccess enum">HeaderVerifySuccess</a></td><td class="docblock-short"></td></tr><tr class="module-item"><td><a class="enum" href="enum.JustificationVerifyError.html" title="smoldot::chain::blocks_tree::JustificationVerifyError enum">JustificationVerifyError</a></td><td class="docblock-short"><p>Error that can happen when verifying a justification.</p>
</td></tr><tr class="module-item"><td><a class="enum" href="enum.SetFinalizedError.html" title="smoldot::chain::blocks_tree::SetFinalizedError enum">SetFinalizedError</a></td><td class="docblock-short"><p>Error that can happen when setting the finalized block.</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="smoldot" data-search-js="../../../search-index.js"></div>
    <script src="../../../main.js"></script></body></html>